<div class="grafica-evento mx-5">
  <div class="grafica-evento-row">
  
    <!-- SIDE BAR -->
    <div class="side-bar">
      <div class="card my-4">
        <div class="card-header font-weight-bold" style="font-size: x-large;" (click)="toggleFilter()">
          Gráficas por sensor <i class="material-icons"> {{ iconFilter }} </i>
        </div>
        <div class="card-body mx-2" [hidden]="showFilter">
          <form [formGroup]="graficaForm" (ngSubmit)="onSubmit()">
            <div class="form-group">
              <label for="maquina">Máquina:</label>
              <select class="form-control" (ngModelChange)="selectedMaquina()"
                id="maquina" formControlName="maquina"
                [ngClass]="{ 'is-invalid': submitted && f.maquina.errors }">
                <option value="">Seleccionar máquina</option>
                <option *ngFor="let m of maquinas" [value]="m.idmaquina">{{m.maquina}} </option>
              </select>
            </div>
            <div class="form-group">
              <label for="area">Área</label>
              <select class="form-control"  id="area"  formControlName="area" 
                [ngClass]="{ 'is-invalid': submitted && f.area.errors }">
                <option value="">Seleccionar área</option>
                <option *ngFor="let a of areas" [value]="a.idarea" [disabled]="false">{{a.area | titlecase}}</option>
              </select>
            </div>
            <div class="form-group">
              <label for="fechaInicio">Fecha Inicio:</label>
              <input type="date" id="fechaInicio" class="form-control"
                [(max)]="maxDate" (change)="fechaChanged()" formControlName="fechaInicio"
                [ngClass]="{ 'is-invalid': submitted && f.fechaInicio.errors }">
            </div>

            <div class="form-group">
              <label for="horaInicio">Hora Inicio:</label>
              <input type="time" step="1"  id="horaInicio" class="form-control"
                 formControlName="horaInicio"
                [ngClass]="{ 'is-invalid': submitted && f.horaInicio.errors }">
            </div>

            <div class="form-group">
              <label for="fechaFin">Fecha Fin:</label>
              <input type="date" id="fechaFin" name="fechaFin" class="form-control" [(max)]="maxDate" [(min)]="minDate"
                [(ngModel)]="fechaFin" formControlName="fechaFin"
                [ngClass]="{ 'is-invalid': submitted && f.fechaFin.errors }">
              <div *ngIf="submitted && f.fechaFin.errors" class="invalid-feedback">
                <div *ngIf="f.fechaFin.errors.mustMatch">Fecha final debe ser mayor a la fecha inicio</div>
              </div>
            </div>

            <div class="form-group">
              <label for="horaFin">Hora Fin:</label>
              <input type="time" step="1" name="horaFin" id="horaFin" class="form-control" [(ngModel)]="horaFin"
                 formControlName="horaFin"
                [ngClass]="{ 'is-invalid': submitted && f.horaFin.errors }">
                <div *ngIf="submitted && f.horaFin.errors" class="invalid-feedback">
                  <div *ngIf="f.horaFin.errors.mustMatch">Hora final debe ser mayor a la hora inicio</div>
                </div>
            </div>
  
            <button type="submit" class="btn btn-secondary btn-sm btn-block">Filtrar</button>
          </form>
        </div>
      </div>
    </div>

    <!-- CARDS SECTION -->
    <div class="cards-section">
      <div class="col">
        <div class="card mb-4">
          <div class="card-body">
            <h5>Gráfica por evento</h5>
            <hr>
            <div id="chartdiv" style="width: 100%; height: 500px"></div>
          </div>
        </div>
      </div>

      <div class="col">
        <div class="card my-4">
          <div class="card-body">
              <h5>Gráfica por tiempo</h5>
              <hr>
            <app-pie [chartData]="dataChart1" [fechaInicio]="fechaInicio" [fechaFin]="fechaFin" [maquina]="maquina" [horaInicio]="horaInicio" 
            [horaFin]="horaFin" *ngIf="chatFlag"></app-pie>
          </div>
        </div>
      </div>

      <div class="col">
        <div class="card mb-4">
          <div class="card-body">
              <h5>Gráfica por tiempo</h5>
              <hr>
            <div id="chartdiv2" style="width: 100%; height: 500px"></div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- SPINNER -->
<ngx-spinner name="mySpinner"></ngx-spinner>